# Internationalization (i18n) Documentation

## Overview

Svns supports multiple languages through a JSON-based localization system. Currently supported languages:
- **English (en-US)** - Default
- **Chinese Simplified (zh-CN)** - 简体中文

## Architecture

### Core Components

1. **ILocalizationService** (`Services/Localization/ILocalizationService.cs`)
   - Interface defining the localization contract
   - Properties: `CurrentCulture`, `AvailableCultures`
   - Methods: `GetString()`, `SetCulture()`
   - Event: `CultureChanged`

2. **LocalizationService** (`Services/Localization/LocalizationService.cs`)
   - Singleton implementation of `ILocalizationService`
   - Loads JSON resource files from `Resources/Strings/`
   - Falls back to embedded default English strings if files not found

3. **LocalizeExtension** (`Services/Localization/LocalizeExtension.cs`)
   - XAML markup extension for data binding
   - Returns observable `LocalizedString` that updates on culture change

4. **Localize** (`Services/Localization/Localize.cs`)
   - Static helper class for code-behind access
   - Methods: `Get()`, `T()` (shorthand)

### Resource Files

Located in `Resources/Strings/`:
- `Strings.en-US.json` - English translations
- `Strings.zh-CN.json` - Chinese translations

## Usage

### In Code (ViewModels, Code-behind)

```csharp
using Svns.Services.Localization;

// Get a localized string
string text = Localize.Get("Common.OK");

// Get with format parameters
string message = Localize.Get("Commit.Success", revisionNumber);

// Shorthand
string text = Localize.T("Common.Cancel");
```

### In XAML

```xml
<!-- Add namespace -->
xmlns:i18n="using:Svns.Services.Localization"

<!-- Use the extension -->
<TextBlock Text="{i18n:Localize Common.OK}"/>

<!-- For properties that need binding -->
<Button Content="{Binding Source={i18n:Localize Common.Cancel}}"/>
```

### Changing Language at Runtime

```csharp
// By culture info
LocalizationService.Instance.SetCulture(new CultureInfo("zh-CN"));

// By language code
LocalizationService.Instance.SetCulture("zh-CN");

// Listen for culture changes
LocalizationService.Instance.CultureChanged += (sender, culture) =>
{
    // Update UI
};
```

### User Settings

Language preference is saved in application settings:
- Settings file: `%LocalAppData%/Svns/svns-settings.json`
- Property: `Language` (empty = system default)

Users can change language in Settings > Appearance > Language.

## String Key Naming Convention

Keys follow a hierarchical dot-notation:

```
Category.Subcategory.Item

Examples:
- Common.OK
- MainWindow.Menu.File
- Commit.Title
- Error.Generic
```

### Categories

| Category | Description |
|----------|-------------|
| `App` | Application-level strings |
| `Common` | Shared UI elements (OK, Cancel, etc.) |
| `MainWindow` | Main window specific |
| `StartPage` | Start page |
| `Status` | SVN status labels |
| `Operation` | SVN operation names |
| `Commit` | Commit dialog |
| `Update` | Update dialog |
| `Checkout` | Checkout dialog |
| `Log` | Log/History view |
| `Diff` | Diff view |
| `Blame` | Blame view |
| `BranchTag` | Branch/Tag dialog |
| `Merge` | Merge dialog |
| `Switch` | Switch dialog |
| `Cleanup` | Cleanup dialog |
| `Lock` | Lock/Unlock dialogs |
| `Conflict` | Conflict resolution |
| `Info` | Info dialog |
| `Properties` | Properties dialog |
| `Settings` | Settings window |
| `RepoBrowser` | Repository browser |
| `Relocate` | Relocate dialog |
| `Import` | Import dialog |
| `Export` | Export dialog |
| `Revert` | Revert operation |
| `Add` | Add operation |
| `Delete` | Delete operation |
| `Rename` | Rename dialog |
| `About` | About dialog |
| `Error` | Error messages |
| `Depth` | Depth options |
| `FileType` | File type labels |

## Adding a New Language

1. Create a new resource file in `Resources/Strings/`:
   ```
   Strings.{culture-code}.json
   ```
   Example: `Strings.ja-JP.json` for Japanese

2. Copy the structure from `Strings.en-US.json`

3. Translate all strings

4. Register the culture in `LocalizationService.cs`:
   ```csharp
   _availableCultures = new List<CultureInfo>
   {
       new CultureInfo("en-US"),
       new CultureInfo("zh-CN"),
       new CultureInfo("ja-JP")  // Add new culture
   };
   ```

5. Add to `SettingsViewModel.cs`:
   ```csharp
   public List<LanguageItem> AvailableLanguages { get; } = new()
   {
       new LanguageItem("", "System Default", "跟随系统"),
       new LanguageItem("en-US", "English", "English"),
       new LanguageItem("zh-CN", "简体中文", "简体中文"),
       new LanguageItem("ja-JP", "Japanese", "日本語")  // Add new language
   };
   ```

6. Build and test

## Adding New Strings

1. Add the key-value pair to **all** language files:
   ```json
   // Strings.en-US.json
   "NewFeature.Title": "New Feature"

   // Strings.zh-CN.json
   "NewFeature.Title": "新功能"
   ```

2. Use in code or XAML:
   ```csharp
   var title = Localize.Get("NewFeature.Title");
   ```

## Format Strings

Use standard C# format placeholders:

```json
"Commit.Success": "Commit successful. Committed revision {0}."
```

```csharp
var message = Localize.Get("Commit.Success", revision);
```

## Best Practices

1. **Always use keys, not hardcoded strings** in UI code
2. **Keep translations in sync** - add strings to all language files
3. **Use meaningful key names** that describe the context
4. **Group related strings** with consistent prefixes
5. **Test with longer languages** - Chinese text is often shorter than English
6. **Handle missing translations gracefully** - system shows `[key]` for missing strings

## Troubleshooting

### Strings show as `[key]`
- Key not found in resource file
- Check spelling of key
- Ensure resource file is copied to output directory

### Language not changing
- Check if `Language` property is saved in settings
- Verify culture code format (e.g., "zh-CN" not "zh_CN")
- Restart application for full effect

### Resource files not found
- Check `Svns.csproj` includes the Content items:
  ```xml
  <Content Include="Resources\Strings\*.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
  </Content>
  ```
