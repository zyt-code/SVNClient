<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Svns.ViewModels"
        xmlns:converters="using:Svns.Converters"
        xmlns:material="using:Material.Icons.Avalonia"
        xmlns:i18n="using:Svns.Services.Localization"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="650"
        x:Class="Svns.Views.Dialogs.CommitDialog"
        x:DataType="vm:CommitViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Commit Changes - Svns"
        Width="700"
        MinWidth="550" MinHeight="500"
        WindowStartupLocation="CenterOwner">

    <Design.DataContext>
        <vm:CommitViewModel/>
    </Design.DataContext>

    <Window.Resources>
        <converters:SvnStatusToIconConverter x:Key="StatusToIconConverter"/>
        <converters:SvnStatusToColorConverter x:Key="StatusToColorConverter"/>
        <converters:FileTypeToIconConverter x:Key="FileTypeToIconConverter"/>
    </Window.Resources>

    <Panel>
        <Grid RowDefinitions="Auto,Auto,*,Auto,Auto" Margin="16">
        <!-- Title -->
        <StackPanel Grid.Row="0" Spacing="4" Margin="0,0,0,16">
            <TextBlock Text="{i18n:Localize Commit.Title}" FontSize="16" FontWeight="Bold" Foreground="#333333"/>
            <TextBlock Text="{i18n:Localize Commit.Subtitle}" FontSize="14" Foreground="#666666"/>
        </StackPanel>

        <!-- Toolbar -->
        <Grid Grid.Row="1" ColumnDefinitions="*,Auto" Margin="0,0,0,12">
            <!-- Left: Search -->
            <Border Grid.Column="0" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Padding="8,6">
                <Grid ColumnDefinitions="Auto,*">
                    <material:MaterialIcon Grid.Column="0" Kind="Magnify" Width="16" Height="16" Foreground="#999999" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Grid.Column="1" Text="{Binding SearchText, Mode=TwoWay}" Watermark="{i18n:Localize Commit.FilterFiles}" BorderThickness="0" Background="Transparent" FontSize="14"/>
                </Grid>
            </Border>

            <!-- Right: Actions -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" Margin="12,0,0,0" VerticalAlignment="Center">
                <TextBlock FontSize="13" Foreground="#666666" VerticalAlignment="Center">
                    <Run Text="{Binding SelectedCount}"/>
                    <Run Text="/"/>
                    <Run Text="{Binding TotalFileCount}"/>
                    <Run Text="{i18n:Localize Common.Selected}"/>
                </TextBlock>
                <Button Command="{Binding ToggleSelectionCommand}" Padding="8,4" FontSize="12" Background="Transparent" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <material:MaterialIcon Kind="{Binding SelectAllIcon}" Width="14" Height="14"/>
                        <TextBlock Text="{Binding SelectAllText}"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- File Tree -->
        <Border Grid.Row="2" Background="White" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4">
            <TreeView ItemsSource="{Binding Files}" Padding="4" MinHeight="200">
                <TreeView.DataTemplates>
                    <TreeDataTemplate DataType="vm:CommitFileNode" ItemsSource="{Binding Children}">
                        <Grid ColumnDefinitions="Auto,Auto,*,Auto" MinHeight="28">
                            <!-- Checkbox (Three-state) -->
                            <CheckBox Grid.Column="0"
                                     IsChecked="{Binding IsChecked}"
                                     IsThreeState="True"
                                     Margin="0,0,8,0"
                                     VerticalAlignment="Center"/>

                            <!-- File/Folder Icon -->
                            <material:MaterialIcon Grid.Column="1"
                                                  Kind="{Binding Path, Converter={StaticResource FileTypeToIconConverter}}"
                                                  Width="16" Height="16"
                                                  Margin="0,0,8,0"
                                                  VerticalAlignment="Center"
                                                  Foreground="#666666"/>

                            <!-- Name -->
                            <TextBlock Grid.Column="2"
                                      Text="{Binding Name}"
                                      FontSize="13"
                                      Foreground="#333333"
                                      TextTrimming="CharacterEllipsis"
                                      VerticalAlignment="Center"
                                      ToolTip.Tip="{Binding Path}"/>

                            <!-- Status Badge -->
                            <Border Grid.Column="3"
                                   Background="{Binding Status, Converter={StaticResource StatusToColorConverter}}"
                                   CornerRadius="3"
                                   Padding="6,2"
                                   Margin="8,0,0,0"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding ShowStatusBadge}">
                                <TextBlock Text="{Binding StatusText}"
                                          FontSize="10"
                                          Foreground="White"
                                          FontWeight="SemiBold"/>
                            </Border>
                        </Grid>
                    </TreeDataTemplate>
                </TreeView.DataTemplates>
            </TreeView>
        </Border>

        <!-- Commit Message -->
        <StackPanel Grid.Row="3" Spacing="6" Margin="0,16,0,0">
            <TextBlock Text="{i18n:Localize Commit.Message}" FontSize="14" Foreground="#666666"/>
            <TextBox Text="{Binding CommitMessage}"
                    AcceptsReturn="True"
                    TextWrapping="Wrap"
                    Watermark="{i18n:Localize Commit.MessagePlaceholder}"
                    Height="80"
                    Background="#F8F8F8"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="8"
                    FontSize="14"/>
        </StackPanel>

        <!-- Footer Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8" Margin="0,16,0,0">
            <Button Content="{i18n:Localize Common.Cancel}"
                   Command="{Binding CancelCommand}"
                   Background="#F0F0F0"
                   Foreground="#666666"
                   BorderThickness="0"
                   CornerRadius="4"
                   Padding="24,10"
                   FontSize="14"/>
            <Button Content="{i18n:Localize Operation.Commit}"
                   Command="{Binding CommitCommand}"
                   IsEnabled="{Binding CanCommit}"
                   Background="#007BFF"
                   Foreground="White"
                   BorderThickness="0"
                   CornerRadius="4"
                   Padding="24,10"
                   FontSize="14"
                   FontWeight="SemiBold"/>
        </StackPanel>
    </Grid>

    <!-- Loading Overlay -->
    <Border Background="#80000000" IsVisible="{Binding IsCommitting}" ZIndex="100">
        <Border Background="White" CornerRadius="8" Padding="24,16" HorizontalAlignment="Center" VerticalAlignment="Center">
            <StackPanel Spacing="12">
                <ProgressBar Width="120" Height="4" IsIndeterminate="True" Foreground="#007BFF"/>
                <TextBlock Text="{i18n:Localize Status.CommittingChanges}" FontSize="14" Foreground="#333333" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Border>
    </Panel>

</Window>
