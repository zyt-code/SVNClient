<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Svns.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="650"
        x:Class="Svns.Views.Dialogs.RepositoryBrowserDialog"
        x:DataType="vm:RepositoryBrowserViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Repository Browser - Svns"
        Classes="dialog large resizable"
        Width="700"
        MinWidth="600" MinHeight="450"
        WindowStartupLocation="CenterOwner">

    <Grid RowDefinitions="Auto,Auto,*,Auto,Auto">
        <!-- Header -->
        <Border Grid.Row="0" Classes="dialog-header">
            <StackPanel Spacing="4">
                <TextBlock Text="Repository Browser" Classes="dialog-title"/>
                <TextBlock Text="Browse and select files from the repository"
                           Classes="dialog-subtitle"/>
            </StackPanel>
        </Border>

        <!-- Navigation Bar -->
        <Border Grid.Row="1"
                Background="{DynamicResource AppSecondaryBackgroundBrush}"
                Padding="24,10,24,10">
            <Grid ColumnDefinitions="Auto,Auto,*,Auto">
                <Button Grid.Column="0"
                        Content="↑"
                        Command="{Binding GoUpCommand}"
                        IsEnabled="{Binding CanGoUp}"
                        Padding="12,8"
                        Margin="0,0,8,0"
                        ToolTip.Tip="Go to parent directory"/>
                <Button Grid.Column="1"
                        Content="⟳"
                        Command="{Binding RefreshCommand}"
                        Padding="12,8"
                        Margin="0,0,16,0"
                        ToolTip.Tip="Refresh"/>
                <Border Grid.Column="2"
                        Background="{DynamicResource InputBackgroundBrush}"
                        BorderBrush="{DynamicResource InputBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12,8">
                    <TextBlock Text="{Binding CurrentPath}"
                               FontSize="13"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               TextTrimming="CharacterEllipsis"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{Binding CurrentPath}"/>
                </Border>
            </Grid>
        </Border>

        <!-- File List -->
        <Border Grid.Row="2"
                Classes="dialog-content"
                Padding="24,8,24,8">
            <Border Classes="dialog-card" Padding="0">
                <Grid>
                    <!-- Loading Overlay -->
                    <Border Background="{DynamicResource AppBackgroundBrush}"
                            Opacity="0.85"
                            IsVisible="{Binding IsLoading}"
                            ZIndex="10"
                            CornerRadius="8">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="10">
                            <ProgressBar Width="100" Height="4" IsIndeterminate="True"/>
                            <TextBlock Text="Loading..." FontSize="12"
                                       Foreground="{DynamicResource SecondaryTextBrush}"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Items Grid -->
                    <DataGrid ItemsSource="{Binding Items}"
                              SelectedItem="{Binding SelectedItem}"
                              AutoGenerateColumns="False"
                              CanUserReorderColumns="False"
                              CanUserResizeColumns="True"
                              CanUserSortColumns="True"
                              IsReadOnly="True"
                              GridLinesVisibility="None"
                              Background="Transparent"
                              BorderThickness="0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="" Binding="{Binding Icon}" Width="40"/>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="2*"/>
                            <DataGridTextColumn Header="Size" Binding="{Binding SizeText}" Width="80"/>
                            <DataGridTextColumn Header="Rev" Binding="{Binding Revision}" Width="60"/>
                            <DataGridTextColumn Header="Author" Binding="{Binding Author}" Width="100"/>
                            <DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="130"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="3" Classes="dialog-status">
            <TextBlock Text="{Binding StatusMessage}"
                       FontSize="12"
                       Foreground="{DynamicResource SecondaryTextBrush}"/>
        </Border>

        <!-- Footer -->
        <Border Grid.Row="4" Classes="dialog-footer">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <Button Grid.Column="1"
                        Content="Cancel"
                        Command="{Binding CloseCommand}"
                        Padding="24,10"
                        Margin="0,0,12,0"/>
                <Button Grid.Column="2"
                        Content="Select"
                        Command="{Binding SelectItemCommand}"
                        Padding="24,10"
                        Classes="primary"/>
            </Grid>
        </Border>
    </Grid>

</Window>
